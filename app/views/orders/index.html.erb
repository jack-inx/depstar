<%#= session[:current_user] %>

<div class="title_bar" id="title_bar">
	<div id="titlebar_left">
		<span class="breadcrumb"> </span>
		<h2 id="page_title">Orders</h2>
	</div>
	<div id="titlebar_right">
		<div class="action_items">
			<span class="action_item"><%= link_to 'New order', new_order_path %></span>
		</div>
	</div>
</div>
<div id="active_admin_content" class="with_sidebar">
	<div id="main_content_wrapper">
		<div id="main_content">
			<form accept-charset="UTF-8" action="/admin/users/batch_action" id="collection_selection" method="post">
				<div style="margin:0;padding:0;display:inline">
					<input name="utf8" type="hidden" value="&#x2713;" />
					<input name="authenticity_token" type="hidden" value="W56Sl/0wERHp6ttqwX96sJ8IVW7zqvAboToL4EOXXUY=" />
				</div>
				<input name="batch_action" id="batch_action" type="hidden">
				</input>
				<div class="paginated_collection">
					<div class="paginated_collection_contents">
						<div class="index_content">
							<div class="index_as_table">
								<table border="0" cellspacing="0" cellpadding="0" id="users" class="index_table index" paginator="true">
									<thead>
										<tr>
											<th class="sortable order_id"><a href="/order_lists?q=order_id&s=desc">Order#</a></th>
											<th class="sortable username"><a href="/order_lists?q=first_name&s=desc">First Name</a></th>
											<th class="sortable email"><a href="/order_lists?q=last_name&s=desc">Last Name</a></th>
											<th class="sortable crypted password">Product</th>
											<th class="sortable created at">Condition</th>
											<th class="sortable created at">Price</th>
											<th class="sortable created at"><a href="/order_lists?q=created_at&s=desc">Created At</a></th>

											<th class=""></th>
										</tr>
									</thead>
									<tbody>
										<% @orders.each do |order| %>
										<tr class="odd" id="user_10">
											<td class="order_id"><%= order.order_id %></td>
											<td class="username"><%= order.first_name %></td>
											<td class="last_name"><%= order.last_name %></td>
											<td class="crypted_password"><%= order.products.all.collect{ |p| [p.name] }.join(", ") %></td>
											<td class="created_at"> <% get_product_price(order.products, order.id).each do |price_type| %>
											<%= price_type.all.collect{ |p| Order::AffiliateConditionCategory[p.price_type_id - 1][0] }.join(', ') %>
											<% end %> </td>
											<td class="created_at"> <% get_product_price(order.products, order.id).each do |price_type| %>
											<%= price_type.all.collect{ |p| p.price }.join(' ') %>
											<% end %> </td>
											<td class="created_at"><%= order.created_at.strftime("%d/%m/%Y %I:%M%p") %></td>
											<td class=""><%= link_to 'Show', order,:class=>"member_link view_link" %> <%= link_to 'Edit', edit_order_path(order),:class=>"member_link edit_link" %> <% if get_user(session[:current_user]).is_affiliate_admin %><%= link_to 'Destroy', order, :confirm => 'Are you sure?', :method => :delete %> <% end %> </td>
										</tr>
										<% end %>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div id="index_footer">
						<div class="pagination_information">
							Displaying <b><%= @orders.count %></b> Order
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>
	<div id="sidebar">
		<div class="sidebar_section panel" id="filters_sidebar_section">
			<h3>Filters</h3>
			<div class="panel_contents">
				<form accept-charset="UTF-8" action="/orders" class="filter_form" id="q_search" method="get">
					<div style="margin:0;padding:0;display:inline">
						<input name="utf8" type="hidden" value="&#x2713;" />
					</div>
					
					<div class="filter_form_field filter_string">
						<label class=" label" for="q_name">Purchase Order Number</label>
						<input id="q_name" name="q[purchase_number]" type="text" MaxLength="6" style="width:51px !important;"/>
					</div>					
					<% if @user.is_affiliate_admin == true %>
					<div class="filter_form_field filter_string">
						<label class=" label" for="q_name">User Name</label>
						<input id="q_name" name="q[name_contains]" type="text" />
					</div>					
					<%end%>
					<label class=" label" for="q_name">Carrier</label>
					<%= select_tag "payment_carrier", options_for_select(Carrier.all.map{ |p| p.name }) ,:prompt => "Select Carrier"%>
					<label class=" label" for="q_name">Product</label>
					<%= select_tag "payment_product", options_for_select(@user.products.all.map{ |p| p.name }) ,:prompt => "Select Product"%>
					<div class="filter_form_field filter_date_range">
						<label class=" label" for="q_created_at_gte">Date</label>
						<input class="datepicker" id="q_created_at_gte" max="10" name="q[created_at_gte]" size="12" type="text" value="" style="width:197px !important;"/>
					</div>
					<div class="filter_form_field filter_string">
						<label class=" label" for="q_name">First Name</label>
						<input id="q_name" name="q[name_contains]" type="text" />
					</div>					
					<div class="filter_form_field filter_string">
						<label class=" label" for="q_name">Last Name</label>
						<input id="q_name" name="q[name_contains]" type="text" />
					</div>					
					<div class="buttons">
						<input name="commit" type="submit" value="Filter" />
						<a href="#" class="clear_filters_btn">Clear Filters</a>
						<input id="order" name="order" type="hidden" value="id_desc" />
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
